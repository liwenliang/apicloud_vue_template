webpackJsonp([3],{"4yJi":function(e,t){},E51W:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("7+uW"),a={name:"App",mounted:function(){var e,t,n,o,a;e=document,t=window,n=e.getElementsByTagName("html")[0],o="orientationchange"in t?"orientationchange":"resize",a=function(){var t=e.documentElement.clientWidth||e.body.clientWidth;t&&(n.style.fontSize=t/750*100+"px")},t.addEventListener(o,a),e.addEventListener("DOMContentLoaded",a)}},i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)};i._withStripped=!0;var r={render:i,staticRenderFns:[]},s=r;var u=n("VU/8")(a,s,!1,null,null,null);u.options.__file="src/App.vue";var p=u.exports,c=n("/ocq"),d={UPDATE_URL:"http://test.proxy.yixi.yaonuokeji.com",APP_VERSION:"1.0.3",CUR_APPID:"appid",VERSION_TYPE:"release",APP_NAME:"template"},l=n("//Fk"),m=n.n(l),f=n("mtWM"),h=n.n(f),w=n("NYxO"),v={namespaced:!0,state:{},mutations:{},actions:{}},_=n("Y4FN"),E=n.n(_),g="template-token";function k(){return E.a.get(g)}var y={namespaced:!0,state:{token:k(),userInfo:{},roles:""},mutations:{SET_TOKEN:function(e,t){e.token=t},SET_USERINFO:function(e,t){e.userInfo=t},SET_ROLES:function(e,t){e.roles=t}},actions:{Login:function(e,t){var n=e.commit;return new m.a(function(e,o){(function(e,t){return A({url:"/user/login",method:"post",data:{mobile:e,password:t}})})(t.mobile,t.password).then(function(t){var o,a=t.data;o=a.token,E.a.set(g,o),n("SET_TOKEN",a.token),e(t)}).catch(function(e){o(e)})})},GetInfo:function(e){var t=e.commit;return new m.a(function(e,n){A({url:"/user/info",method:"get",params:{}}).then(function(n){t("SET_USERINFO",n.data),t("SET_ROLES",n.data.roles),e(n)}).catch(function(e){n(e)})})},FedLogOut:function(e){var t=e.commit;return new m.a(function(e){t("SET_TOKEN",""),E.a.remove(g),e()})}}},S={token:function(e){return e.user.token},userInfo:function(e){return e.user.userInfo},roles:function(e){return e.user.roles}};o.a.use(w.a);var P=new w.a.Store({modules:{app:v,user:y},getters:S}),x="FINGER_APP",b=h.a.create({baseURL:"http://apitest.proxy.aikeyi.yaonuokeji.com",timeout:5e3});b.interceptors.request.use(function(e){return P.getters.token&&("post"===e.method?(e.data||(e.data={}),e.data.token=k()):(e.params=e.params||{},e.params.token=k())),"post"===e.method?e.data.app=x:e.params.app=x,e},function(e){console.log(e),m.a.reject(e)}),b.interceptors.response.use(function(e){return e.data},function(e){return console.log("err"+e),m.a.reject(e)});var A=b;var R={name:"UpdateWidgets",data:function(){return{downloadMessage:"",openSimple:!1}},mounted:function(){this.startCheck()},methods:{startCheck:function(){var e=this;setTimeout(function(){window.api?e.checkUpdate():e.startCheck()},500)},checkUpdate:function(e){var t=this;(function(e){var t=e.app_version;return A({url:d.UPDATE_URL+"/version/checkUpdate.json",method:"get",params:{app_version:t}})})({app_version:[d.APP_NAME,window.api.systemType,d.VERSION_TYPE,d.APP_VERSION].join("-")}).then(function(n){if(n&&0===n.code&&n.data&&n.data.needUpdate&&n.data.lastVersion){var o=n.data.lastVersion;switch(o.update_type){case"1":window.api.confirm({title:"应用升级",msg:o.describe||"",buttons:["现在升级","遗憾错过"]},function(e,n){1===e.buttonIndex&&t.startdown(o.download_url,"option",o.app_version)});break;case"2":window.api.alert({title:"应用升级",msg:o.describe||"",buttons:["确定"]},function(e,n){1===e.buttonIndex&&t.startdown(o.download_url,"force",o.app_version)})}}else t.openSimple=!1,e&&window.api.toast({msg:"当前已是最新版本！",duration:3e3,location:"middle"})})},closeCurApp:function(){window.api.closeWidget({id:d.CUR_APPID,silent:!0,retData:{name:"closeWidget"},animation:{type:"flip",subType:"from_bottom",duration:500}})},startdown:function(e,t,n){var o=this;switch(window.api.systemType){case"ios":window.api.installApp({appUri:e}),this.closeCurApp();break;case"android":window.api.download({url:e,savePath:"fs://"+d.APP_NAME+"/update/"+n+".apk",report:!0,cache:!1,allowResume:!0},function(e,t){if(e)switch(e.state){case 2:window.api.alert({title:"更新失败",msg:"下载更新失败,请退出重试",buttons:["确定"]},function(e,t){1===e.buttonIndex&&o.closeCurApp()});break;case 1:window.api.installApp({appUri:e.savePath}),o.openSimple=!1,o.closeCurApp();break;case 0:var n=e.fileSize/1024/1024;n=parseFloat(n).toFixed(1),o.downloadMessage="文件大小："+n+"M;下载进度："+e.percent+"%;",o.openSimple=!0}})}}}},U=function(){var e=this,t=e.$createElement;return(e._self._c||t)("mu-dialog",{attrs:{open:e.openSimple,"overlay-close":!1,title:"升级提示"},on:{"update:open":function(t){e.openSimple=t}}},[e._v("\n  "+e._s(e.downloadMessage)+"\n")])};U._withStripped=!0;var I={render:U,staticRenderFns:[]},T=I;var N=n("VU/8")(R,T,!1,null,null,null);N.options.__file="src/components/widgets/update.vue";var O={name:"Layout",components:{UpdateWidgets:N.exports},computed:{key:function(){return void 0!==this.$route.name?this.$route.name+ +new Date:this.$route+ +new Date}}},F=function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("UpdateWidgets"),this._v(" "),t("transition",{attrs:{name:"fade",mode:"out-in"}},[t("router-view",{key:this.key})],1)],1)};F._withStripped=!0;var L={render:F,staticRenderFns:[]},C=L;var M=n("VU/8")(O,C,!1,null,null,null);M.options.__file="src/views/layout/Layout.vue";var W=M.exports;o.a.use(c.a);var V=new c.a({routes:[{path:"/login",component:function(){return n.e(0).then(n.bind(null,"T+/8"))}},{path:"/",name:"Index",redirect:"/home",component:W,children:[{path:"home",name:"Home",component:function(){return n.e(1).then(n.bind(null,"KR8f"))}}]}]}),j=n("aFc6"),D=(n("E51W"),n("+nBf")),H=n.n(D),$=n("w7Ps"),z=n("sXio"),X=n("1kwf"),q=["/login"];V.beforeEach(function(e,t,n){k()?"/login"===e.path?n({path:"/"}):""===P.getters.roles?P.dispatch("user/GetInfo").then(function(t){0===t.code&&n({to:e,replace:!0})}).catch(function(e){console.log(e),P.dispatch("user/FedLogOut").then(function(){n({path:"/"})})}):n():-1!==q.indexOf(e.path)?n():n("/login?redirect="+e.path)}),n("qs/E"),o.a.use(j.a),o.a.use(H.a),o.a.use($.a),o.a.use(z.a),o.a.use(X.a),new o.a({el:"#app",router:V,store:P,components:{App:p},template:"<App/>"})},kLMm:function(e,t){},"m/7z":function(e,t){},mhXF:function(e,t){},"qs/E":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("zNUS"),a=n.n(o),i={code:0,data:{userInfo:{name:"admin"},token:"tokenxxxxxxx",roles:["admin"]}},r=function(e){return i},s=function(e){return i};a.a.XHR.prototype.proxy_send=a.a.XHR.prototype.send,a.a.XHR.prototype.send=function(){this.custom.xhr&&(this.custom.xhr.withCredentials=this.withCredentials||!1),this.proxy_send.apply(this,arguments)},a.a.mock(/\/user\/login/,"post",r()),a.a.mock(/\/user\/info\.*/,"get",s);t.default=a.a},uPa8:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.dc4c587c5db764dc4f99.js.map